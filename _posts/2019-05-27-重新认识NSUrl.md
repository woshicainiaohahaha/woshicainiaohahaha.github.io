---
layout: article
title: é‡æ–°è®¤è¯†NSURL
article_header:
type: overlay
theme: dark
background_color: '#123'
background_image: false
---

ä»è¿™ç¯‡æ–‡ç« å¼€å§‹å°†ä¼šå¯¹iOSä¸­çš„ç½‘ç»œéƒ¨åˆ†è¿›è¡Œé‡æ–°çš„è®¤è¯†ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä¸ºåŸºç¡€çŸ¥è¯†ï¼Œå°†å¸¸è§çš„å’Œä¸å¸¸è§çš„å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ï¼Œä¾›ä»¥åå¤ä¹ ä½¿ç”¨ã€‚

### URL

åœ¨wwwä¸Šï¼Œæ¯ä¸€ä¿¡æ¯èµ„æºéƒ½æœ‰ç»Ÿä¸€çš„ä¸”åœ¨ç½‘ä¸Šå”¯ä¸€çš„åœ°å€ï¼Œè¯¥åœ°å€å°±å«URLï¼ˆUniform Resource Locatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ï¼Œå®ƒæ˜¯wwwçš„ç»Ÿä¸€èµ„æºå®šä½æ ‡å¿—ï¼Œå°±æ˜¯æŒ‡ç½‘ç»œåœ°å€ã€‚

**URLçš„ç¼–ç **

URL é‡‡ç”¨ ASCII ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¦‚ä¸­æ–‡ç­‰é ASCII ç å­—ç¬¦ï¼Œå¦å¤– URL ä¸­ä¿ç•™çš„åˆ†éš”ç¬¦å·(?ã€&ã€=ç­‰)ä¹Ÿæ— æ³•ä½œä¸ºå†…å®¹ï¼Œå¦åˆ™ä¼šå¼•èµ·æ­§ä¹‰ã€‚è¿™å°±éœ€è¦é€šè¿‡ç¼–ç ï¼Œç”¨å®‰å…¨çš„å­—ç¬¦æ¥è¡¨ç¤ºè¿™äº›ä¸ç¬¦åˆè¦æ±‚çš„å­—ç¬¦ï¼Œæ ¼å¼æ˜¯%åŠ ä¸¤ä½å®‰å…¨å­—ç¬¦ï¼Œæ‰€ä»¥ URL ç¼–ç ä¹Ÿç§°ä¸ºç™¾åˆ†å·ç¼–ç ã€‚åœ¨ iOS ä¸­çš„ç›¸å…³æ“ä½œåˆ†åˆ«ä¸ºï¼š

**Encode**

```
NSString *encodedString = [URLString stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]];

@interface NSCharacterSet (NSURLUtilities)
+ (NSCharacterSet *)URLUserAllowedCharacterSet;  //"#%<>[\]^`{|}
+ (NSCharacterSet *)URLPasswordAllowedCharacterSet;  //"#%/<>?@\^`{|}
+ (NSCharacterSet *)URLHostAllowedCharacterSet;  //"#%/:<>?@[\]^`{|}
+ (NSCharacterSet *)URLPathAllowedCharacterSet; //"#%;<>?[\]^`{|}
+ (NSCharacterSet *)URLQueryAllowedCharacterSet;  //"#%<>[\]^`{|}
+ (NSCharacterSet *)URLFragmentAllowedCharacterSet;  //"#%/:<>?@[\]^`
@end
```

**Decode**

```
+ (NSString *)decodeURLString:(NSString *)URLString {
    // æœ‰æ—¶ä»æœåŠ¡ç«¯è·å–çš„ URL ä¸­ï¼Œç©ºæ ¼è¢«ç¼–ç ä¸º+, 
    // è€Œæ–¹æ³•- stringByRemovingPercentEncodingåªæ›¿æ¢ç™¾åˆ†å·ç¼–ç ï¼Œ
    // æ‰€ä»¥è¦åœ¨æ‰§è¡Œè¯¥æ–¹æ³•å‰ï¼Œå…ˆå°†`+`æ›¿æ¢æ‰(çœŸæ­£çš„åŠ å·å­—ç¬¦æ˜¯è¢«ç™¾åˆ†å·ç¼–ç çš„)
    NSString *result = [URLString stringByReplacingOccurrencesOfString:@"+" withString:@" "];
    result = [result stringByRemovingPercentEncoding];
    
    return result;
}
```

**æ³¨æ„**

åœ¨ç¼–ç çš„æ—¶å€™åŒæ ·ä¼šå°†â€œ+â€æ›¿æ¢ä¸ºâ€œ â€ï¼Œä¸ºäº†ä¿è¯ç‰¹æ®Šå­—ç¬¦ä¸è¢«æ›¿æ¢æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å­—ç¬¦é›†ï¼š

```
+ (NSString *)urlEncodeForStr:(NSString *)str {
    NSString *charactersToEscape = @"?!@#$^&%*+,:;='\"`<>()[]{}/\\| ";
    NSCharacterSet *allowedCharacters = [[NSCharacterSet characterSetWithCharactersInString:charactersToEscape] invertedSet];
    return [str stringByAddingPercentEncodingWithAllowedCharacters:allowedCharacters];
}
```

**URLçš„ç»„æˆ**

URLçš„ä¸€èˆ¬è¯­æ³•æ ¼å¼ä¸º(å¸¦æ–¹æ‹¬å·[]çš„ä¸ºå¯é€‰é¡¹)ï¼š
protocol://hostname[:port]/path/[;parameters][?query]#fragment
å®Œæ•´çš„ã€å¸¦æœ‰æˆæƒéƒ¨åˆ†çš„æ™®é€šç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦è¯­æ³•æ ¼å¼ä¸ºï¼š
åè®®://ç”¨æˆ·å:å¯†ç @å­åŸŸå.åŸŸå.é¡¶çº§åŸŸå:ç«¯å£å·/ç›®å½•/æ–‡ä»¶å.æ–‡ä»¶åç¼€?å‚æ•°=å€¼#æ ‡å¿—

**URLçš„æ ¼å¼è¯´æ˜**

1. åè®®ï¼ˆprotocolï¼‰ï¼šæŒ‡å®šä½¿ç”¨çš„ä¼ è¾“åè®®ï¼Œä¸‹è¡¨åˆ—å‡º protocol å±æ€§çš„æœ‰æ•ˆæ–¹æ¡ˆåç§°ã€‚ æœ€å¸¸ç”¨çš„æ˜¯ HTTPåè®®ï¼Œå®ƒä¹Ÿæ˜¯ç›®å‰wwwä¸­åº”ç”¨æœ€å¹¿çš„åè®®ã€‚
	- http é€šè¿‡ HTTP è®¿é—®è¯¥èµ„æºã€‚ æ ¼å¼ http://
	- https é€šè¿‡å®‰å…¨çš„ HTTPS è®¿é—®è¯¥èµ„æºã€‚ æ ¼å¼ https://
	- file èµ„æºæ˜¯æœ¬åœ°è®¡ç®—æœºä¸Šçš„æ–‡ä»¶ã€‚ æ ¼å¼ file:///ï¼ˆæ³¨æ„åè¾¹åº”æ˜¯ä¸‰ä¸ªæ–œæ ï¼‰
	- ftp é€šè¿‡ FTP è®¿é—®è¯¥èµ„æºã€‚ æ ¼å¼ ftp://
	- mailto èµ„æºä¸ºç”µå­é‚®ä»¶åœ°å€ï¼Œé€šè¿‡ SMTP è®¿é—®ã€‚ æ ¼å¼ mailto:
	- MMS é€šè¿‡æ”¯æŒ MMSï¼ˆæµåª’ä½“ï¼‰åè®®çš„æ’­æ”¾è¯¥èµ„æºã€‚ï¼ˆä»£è¡¨è½¯ä»¶ï¼šWindows Media Playerï¼‰ æ ¼å¼ MMS://
	- ed2k é€šè¿‡æ”¯æŒ ed2kï¼ˆä¸“ç”¨ä¸‹è½½é“¾æ¥ï¼‰åè®®çš„ P2P è½¯ä»¶è®¿é—®è¯¥èµ„æºã€‚ï¼ˆä»£è¡¨è½¯ä»¶ï¼šç”µé©´ï¼‰ æ ¼å¼ ed2k://
	- ç­‰ï¼›
2. ä¸»æœºåï¼ˆhostnameï¼‰ï¼šæ˜¯æŒ‡å­˜æ”¾èµ„æºçš„æœåŠ¡å™¨çš„åŸŸåç³»ç»Ÿ(DNS) ä¸»æœºåæˆ– IP åœ°å€ã€‚æœ‰æ—¶ï¼Œåœ¨ä¸»æœºåå‰ä¹Ÿå¯ä»¥åŒ…å«è¿æ¥åˆ°æœåŠ¡å™¨æ‰€éœ€çš„ç”¨æˆ·åå’Œå¯†ç ï¼ˆæ ¼å¼ï¼šusername:password@hostnameï¼‰ã€‚
3. ç«¯å£å·ï¼ˆportï¼‰ï¼šæ•´æ•°ï¼Œå¯é€‰ï¼Œçœç•¥æ—¶ä½¿ç”¨æ–¹æ¡ˆçš„é»˜è®¤ç«¯å£ï¼Œå„ç§ä¼ è¾“åè®®éƒ½æœ‰é»˜è®¤çš„ç«¯å£å·ï¼Œå¦‚httpçš„é»˜è®¤ç«¯å£ä¸º80ã€‚å¦‚æœè¾“å…¥æ—¶çœç•¥ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç«¯å£å·ã€‚æœ‰æ—¶å€™å‡ºäºå®‰å…¨æˆ–å…¶ä»–è€ƒè™‘ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå¯¹ç«¯å£è¿›è¡Œé‡å®šä¹‰ï¼Œå³é‡‡ç”¨éæ ‡å‡†ç«¯å£å·ï¼Œæ­¤æ—¶ï¼ŒURLä¸­å°±ä¸èƒ½çœç•¥ç«¯å£å·è¿™ä¸€é¡¹ã€‚
4. è·¯å¾„ï¼ˆpathï¼‰ï¼šç”±é›¶æˆ–å¤šä¸ªâ€œ/â€ç¬¦å·éš”å¼€çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºä¸»æœºä¸Šçš„ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶åœ°å€ã€‚
5. å‚æ•°ï¼šè¿™æ˜¯ç”¨äºæŒ‡å®šç‰¹æ®Šå‚æ•°çš„å¯é€‰é¡¹ã€‚
6. æŸ¥è¯¢ï¼šå¯é€‰ï¼Œç”¨äºç»™åŠ¨æ€ç½‘é¡µï¼ˆå¦‚ä½¿ç”¨CGIã€ISAPIã€PHP/JSP/ASP/ASP.NETç­‰æŠ€æœ¯åˆ¶ä½œçš„ç½‘é¡µï¼‰ä¼ é€’å‚æ•°ï¼Œå¯æœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨â€œ&â€ç¬¦å·éš”å¼€ï¼Œæ¯ä¸ªå‚æ•°çš„åå’Œå€¼ç”¨â€œ=â€ç¬¦å·éš”å¼€ã€‚
7. ä¿¡æ¯ç‰‡æ–­ï¼šå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šç½‘ç»œèµ„æºä¸­çš„ç‰‡æ–­ã€‚ä¾‹å¦‚ä¸€ä¸ªç½‘é¡µä¸­æœ‰å¤šä¸ªåè¯è§£é‡Šï¼Œå¯ä½¿ç”¨fragmentç›´æ¥å®šä½åˆ°æŸä¸€åè¯è§£é‡Šã€‚

è€Œåœ¨ Objective-C ä¸­ï¼Œè¿™äº›ç»„æˆéƒ¨åˆ†å¯ä»¥ç”¨ç³»ç»Ÿæä¾›çš„æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–åˆ°ï¼Œè€Œä¸ç”¨éº»çƒ¦çš„å¤„ç†ä¸€å †å­—ç¬¦ä¸²ï¼Œä¸‹é¢ç»™å¤§å®¶ä¸¾ä¸ªæ —å­ğŸŒ°ã€‚

```
    NSString *urlStr = @"https://www.testurl.com:8080/path/subpath;parms=test_parms?uid=123&gid=45#fragment=009&fragment";
    NSURL    *URL = [NSURL URLWithString:urlStr];
    NSString *absoluteString = URL.absoluteString;
    NSString *baseURL = URL.baseURL.absoluteString;
    NSString *scheme = URL.scheme;
    NSString *host = URL.host;
    NSString *path = URL.path;
    NSArray  *pathComponents = URL.pathComponents;
    NSString *lastPathComponent = URL.lastPathComponent;
    NSString *pathExtension = URL.pathExtension;
    NSString *query = URL.query;
    NSString *fragment = URL.fragment;
    NSString *parameterString = URL.parameterString;
    NSString *relativePath = URL.relativePath;
    NSString *port = [URL.port stringValue];
    NSString *user = URL.user;
    NSString *password = URL.password;
// absoluteString = https://www.testurl.com:8080/path/subpath;parms=test_parms?uid=123&gid=45#fragment=009&fragment
    NSLog(@"absoluteString = %@", absoluteString);
    // baseURL = (null)
    NSLog(@"baseURL = %@", baseURL);
    // scheme = https
    NSLog(@"scheme = %@", scheme);
    // host = www.testurl.com
    NSLog(@"host = %@", host);
    // port = 8080
    NSLog(@"port = %@", port);
    // path = /path/subpath
    NSLog(@"path = %@", path);
    // pathComponents = ("/", path, subpath)
    NSLog(@"pathComponents = %@", pathComponents);
    // lastPathComponent = subpath
    NSLog(@"lastPathComponent = %@", lastPathComponent);
    // pathExtension = @""  //<object returned empty description>
    NSLog(@"pathExtension = %@", pathExtension);
    // query = uid=123&gid=45
    NSLog(@"query = %@", query);
    // fragment = fragment=009&fragment
    NSLog(@"fragment = %@", fragment);
    // relativePath = /path/subpath (The same as path if baseURL is nil)
    NSLog(@"relativePath = %@", relativePath);
    // parameterString = parms=test_parms
    NSLog(@"parameterString = %@", parameterString);
    // user = (null)
    NSLog(@"user = %@", user);
    // password = (null)
    NSLog(@"password = %@", password);
```

**NSURL**

ä¸€ä¸ª NSURL å¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªè¡¨ç¤ºè¿œç¨‹æœåŠ¡å™¨èµ„æºæˆ–è€…æœ¬åœ°æ–‡ä»¶çš„ URLã€‚æ‰€ä»¥åœ¨ iOS çš„ç½‘ç»œè¯·æ±‚å’Œæ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„ API ä¸­ï¼Œå¾ˆå¤šéƒ½éœ€è¦ NSURL ç±»å‹çš„å‚æ•°ã€‚

åˆ›å»º NSURL å¯¹è±¡

1.ä¼ å…¥çš„å­—ç¬¦ä¸²ç±»å‹çš„ URL å‚æ•°è¦æ±‚æ˜¯ç»è¿‡ç¼–ç åçš„ï¼Œå¦‚æœè¯¥å‚æ•°ä¸ç¬¦åˆè§„èŒƒæˆ–è€…ä¼ å…¥äº† nilï¼Œé‚£ä¹ˆä¸Šè¿°æ–¹æ³•ä¼šè¿”å› nilã€‚
```
+ URLWithString:
- initWithString:
```
2.é™¤äº†å­—ç¬¦ä¸²ç±»å‹çš„ URL å‚æ•°ï¼Œè¿˜éœ€è¦ä¸€ä¸ª NSURL ç±»å‹çš„ Base URL å‚æ•°ï¼Œå­—ç¬¦ä¸²ç±»å‹çš„ URL å°†ä½œä¸º Base URL çš„ç›¸å¯¹è·¯å¾„ã€‚åŒæ ·å­—ç¬¦ä¸²ç±»å‹çš„ URL å‚æ•°è¦æ±‚æ˜¯ç»è¿‡ç¼–ç åçš„ï¼Œå¦‚æœä¸ç¬¦åˆè§„èŒƒæˆ–è€…ä¼ å…¥äº† nilï¼Œé‚£ä¹ˆä¹Ÿä¼šè¿”å› nilã€‚
```
+ URLWithString:relativeToURL:
- initWithString:relativeToURL:
```
3.åˆ›å»ºä¸€ä¸ª file URL (åè®®ä¸ºfile:///)ï¼Œå‚æ•° Path éœ€è¦ä¼ å…¥ä¸€ä¸ªç³»ç»Ÿè·¯å¾„ï¼Œå¦‚æœè·¯å¾„ä¸­åŒ…å«~ï¼Œé‚£ä¹ˆéœ€è¦å…ˆè°ƒç”¨ NSString çš„stringByExpandingTildeInPathæ–¹æ³•è§£æ~ï¼Œå¦‚æœä¼ å…¥çš„è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ URL å°†ç›¸å¯¹äºå½“å‰è·¯å¾„ã€‚å½“æ²¡æœ‰ isDirectory å‚æ•°æ—¶ï¼Œå¦‚æœè·¯å¾„ä»¥/ç»“æŸï¼Œåˆ™è®¤ä¸ºè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œè‹¥ä¸æ˜¯ä»¥/ç»“æŸï¼Œåˆ™ç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œè‹¥è·¯å¾„å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™ç³»ç»Ÿä¼šåœ¨è·¯å¾„åæ·»åŠ /ï¼Œè‹¥è·¯å¾„ä¸å­˜åœ¨ï¼Œç³»ç»Ÿåˆ™è®¤ä¸ºè·¯å¾„ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ã€‚è€Œ isDirectory å‚æ•°åˆ™æ˜ç¡®æŒ‡æ˜è·¯å¾„æ˜¯å¦ä»£è¡¨ä¸€ä¸ªç›®å½•ã€‚
```
+ fileURLWithPath:
- initFileURLWithPath:
+ fileURLWithPath:isDirectory:
- initFileURLWithPath:isDirectory:
```

**NSURLæ‹¼æ¥**

```
- URLByAppendingPathComponent:  //è¿”å›ä¸€ä¸ªæ–°çš„ file path URLï¼Œè¿™ä¸ª URL åœ¨åŸ URL å¯¹è±¡åæ·»åŠ äº†ä¼ å…¥çš„ä¸€æ®µè·¯å¾„å‚æ•°ã€‚è¯¥æ–¹æ³•ä¼šè‡ªåŠ¨åœ¨åŸ URL å¯¹è±¡å’Œæ–°çš„ path é—´åŠ å…¥'/'ï¼Œå¦‚æœ path å‚æ•°æœ€åæ²¡æœ‰ä»¥/ç»“å°¾ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šåŒæ­¥æ£€æµ‹æ–° URL å¯¹è±¡æŒ‡å‘çš„èµ„æºæ˜¯å¦å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¦‚æœè·¯å¾„æŒ‡å‘ç½‘ç»œæŒ‚è½½å·ï¼Œè¿™å°†ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½æŸè€—ã€‚
- URLByAppendingPathComponent:isDirectory: //åŠŸèƒ½åŒä¸Šä¸€ä¸ªæ–¹æ³•ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ isDirectory å‚æ•°å…·ä½“æŒ‡æ˜æ–°çš„ file URL æ˜¯å¦ä¸ºä¸€ä¸ªç›®å½•ï¼Œä»è€Œé¿å…ç³»ç»Ÿçš„åŒæ­¥æ£€æµ‹ã€‚
- URLByAppendingPathExtension:  //è¿”å›ä¸€ä¸ªæ·»åŠ æ‰©å±•åçš„ URL å¯¹è±¡ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªåŠ¨å»æ‰åŸ URL å¯¹è±¡æœ€åçš„/å¹¶æ·»åŠ .
- URLByDeletingLastPathComponent  //å»æ‰æœ€åä¸€æ®µ path çš„ URL å¯¹è±¡
- URLByDeletingPathExtension  //å»æ‰æœ€åä¸€æ®µæ–‡ä»¶æ‰©å±•åçš„ URL å¯¹è±¡
- URLByResolvingSymlinksInPath  //ä¸€ä¸ªè§£æäº† symbolic link åçš„ URL
- URLByStandardizingPath  //ä¸€ä¸ªè§£æäº† symbolic link åçš„ URL
```

**file URL æ£€æµ‹**

- fileURLï¼Œå¸ƒå°”å€¼ï¼ŒæŒ‡æ˜ URL æ˜¯å¦ä½¿ç”¨file:///åè®®ï¼Œæ— è®ºæ˜¯ file path URL è¿˜æ˜¯ file reference URL
- isFileReferenceURLï¼Œè¿”å›å¸ƒå°”å€¼ï¼Œè¯´æ˜ URL å¯¹è±¡æ˜¯å¦ä¸º file reference URL
- checkResourceIsReachableAndReturnError:ï¼Œè¿”å›å¸ƒå°”å€¼ï¼Œè¯´æ˜ file URL æŒ‡å‘çš„æ–‡ä»¶èµ„æºæ˜¯å¦å¯è·å–ï¼Œè‹¥è¿”å› NOï¼Œé€šè¿‡ error å‚æ•°å¯ä»¥è·å–æ›´å¤šä¿¡æ¯
